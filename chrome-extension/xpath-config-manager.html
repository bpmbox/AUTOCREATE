<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>XPathè¨­å®šç®¡ç† / XPath Configuration Manager</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            min-height: 100vh;
        }
        
        .container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        
        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 30px;
            font-size: 2em;
        }
        
        .xpath-section {
            margin: 20px 0;
            padding: 20px;
            border: 2px solid #3498db;
            border-radius: 10px;
            background: #f0f8ff;
        }
        
        .xpath-item {
            margin: 15px 0;
            padding: 15px;
            background: white;
            border-radius: 8px;
            border-left: 4px solid #3498db;
        }
        
        .xpath-label {
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 5px;
        }
        
        .xpath-input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            background: #f9f9f9;
        }
        
        .xpath-description {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }
        
        .button-group {
            display: flex;
            gap: 10px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            text-align: center;
        }
        
        .btn-primary {
            background: linear-gradient(45deg, #3498db, #2980b9);
            color: white;
        }
        
        .btn-success {
            background: linear-gradient(45deg, #27ae60, #229954);
            color: white;
        }
        
        .btn-warning {
            background: linear-gradient(45deg, #f39c12, #e67e22);
            color: white;
        }
        
        .btn-danger {
            background: linear-gradient(45deg, #e74c3c, #c0392b);
            color: white;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .results {
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #3498db;
            max-height: 300px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
        }
        
        .success {
            color: #27ae60;
        }
        
        .error {
            color: #e74c3c;
        }
        
        .info {
            color: #3498db;
        }
        
        .warning {
            color: #f39c12;
        }
        
        .preset-buttons {
            display: flex;
            gap: 10px;
            margin: 10px 0;
            flex-wrap: wrap;
        }
        
        .preset-btn {
            padding: 8px 15px;
            background: #ecf0f1;
            border: 1px solid #bdc3c7;
            border-radius: 15px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s ease;
        }
        
        .preset-btn:hover {
            background: #d5dbdb;
            transform: translateY(-1px);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>âš™ï¸ XPathè¨­å®šç®¡ç†<br>XPath Configuration Manager</h1>
        
        <div class="xpath-section">
            <h3>ğŸ“ åŸºæœ¬XPathè¨­å®š / Basic XPath Settings</h3>
            
            <div class="xpath-item">
                <div class="xpath-label">ğŸ’¬ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å…¥åŠ›æ¬„ / Message Input Field</div>
                <input type="text" class="xpath-input" id="message-input-xpath" 
                       placeholder="ä¾‹: //textarea[@id='message-input'] ã¾ãŸã¯ //input[@name='message']">
                <div class="xpath-description">ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å…¥åŠ›ã™ã‚‹ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢ã‚„inputè¦ç´ ã®XPath</div>
                <div class="preset-buttons">
                    <button class="preset-btn" onclick="setPreset('message-input-xpath', '//textarea[contains(@class, &quot;message&quot;)]')">æ±ç”¨textarea</button>
                    <button class="preset-btn" onclick="setPreset('message-input-xpath', '//input[@type=&quot;text&quot;]')">æ±ç”¨input</button>
                    <button class="preset-btn" onclick="setPreset('message-input-xpath', '//div[@contenteditable=&quot;true&quot;]')">ç·¨é›†å¯èƒ½div</button>
                </div>
            </div>
            
            <div class="xpath-item">
                <div class="xpath-label">ğŸ“¤ é€ä¿¡ãƒœã‚¿ãƒ³ / Send Button</div>
                <input type="text" class="xpath-input" id="send-button-xpath" 
                       placeholder="ä¾‹: //button[@type='submit'] ã¾ãŸã¯ //button[contains(text(), 'é€ä¿¡')]">
                <div class="xpath-description">ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡ãƒœã‚¿ãƒ³ã®XPath</div>
                <div class="preset-buttons">
                    <button class="preset-btn" onclick="setPreset('send-button-xpath', '//button[@type=&quot;submit&quot;]')">é€ä¿¡ãƒœã‚¿ãƒ³</button>
                    <button class="preset-btn" onclick="setPreset('send-button-xpath', '//button[contains(text(), &quot;é€ä¿¡&quot;)]')">é€ä¿¡ãƒ†ã‚­ã‚¹ãƒˆ</button>
                    <button class="preset-btn" onclick="setPreset('send-button-xpath', '//button[contains(text(), &quot;Send&quot;)]')">Send</button>
                </div>
            </div>
            
            <div class="xpath-item">
                <div class="xpath-label">ğŸ’¬ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤ºã‚¨ãƒªã‚¢ / Message Display Area</div>
                <input type="text" class="xpath-input" id="message-display-xpath" 
                       placeholder="ä¾‹: //div[@class='chat-messages'] ã¾ãŸã¯ //ul[@id='message-list']">
                <div class="xpath-description">æ–°ã—ã„ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã‚¨ãƒªã‚¢ã®XPath</div>
                <div class="preset-buttons">
                    <button class="preset-btn" onclick="setPreset('message-display-xpath', '//div[contains(@class, &quot;chat&quot;)]')">ãƒãƒ£ãƒƒãƒˆã‚¨ãƒªã‚¢</button>
                    <button class="preset-btn" onclick="setPreset('message-display-xpath', '//div[contains(@class, &quot;message&quot;)]')">ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚¨ãƒªã‚¢</button>
                    <button class="preset-btn" onclick="setPreset('message-display-xpath', '//ul[contains(@class, &quot;list&quot;)]')">ãƒªã‚¹ãƒˆå½¢å¼</button>
                </div>
            </div>
        </div>
        
        <div class="xpath-section">
            <h3>ğŸŒ ã‚µã‚¤ãƒˆåˆ¥è¨­å®š / Site-specific Settings</h3>
            
            <div class="xpath-item">
                <div class="xpath-label">ğŸ¯ å¯¾è±¡ã‚µã‚¤ãƒˆURL / Target Site URL</div>
                <input type="text" class="xpath-input" id="target-site-url" 
                       placeholder="ä¾‹: https://supabase-message-stream.lovable.app/">
                <div class="xpath-description">XPathã‚’é©ç”¨ã™ã‚‹ã‚µã‚¤ãƒˆã®URLï¼ˆéƒ¨åˆ†ä¸€è‡´ï¼‰</div>
            </div>
            
            <div class="xpath-item">
                <div class="xpath-label">ğŸ“‹ è¨­å®šå / Configuration Name</div>
                <input type="text" class="xpath-input" id="config-name" 
                       placeholder="ä¾‹: Supabase Chatã€ProcessMakerã€ã‚«ã‚¹ã‚¿ãƒ ã‚µã‚¤ãƒˆ">
                <div class="xpath-description">ã“ã®è¨­å®šã®è­˜åˆ¥å</div>
            </div>
        </div>
        
        <div class="xpath-section">
            <h3>ğŸ§ª XPathãƒ†ã‚¹ãƒˆ / XPath Testing</h3>
            
            <div class="button-group">
                <button class="btn btn-primary" onclick="testXPath()">
                    ğŸ” XPathãƒ†ã‚¹ãƒˆ / Test XPath
                </button>
                <button class="btn btn-warning" onclick="validateXPath()">
                    âœ… XPathæ¤œè¨¼ / Validate XPath
                </button>
                <button class="btn btn-success" onclick="saveXPathConfig()">
                    ğŸ’¾ è¨­å®šä¿å­˜ / Save Configuration
                </button>
                <button class="btn btn-danger" onclick="resetXPathConfig()">
                    ğŸ”„ è¨­å®šãƒªã‚»ãƒƒãƒˆ / Reset Configuration
                </button>
            </div>
            
            <div class="results" id="test-results"></div>
        </div>
        
        <div class="xpath-section">
            <h3>ğŸ“š ä¿å­˜æ¸ˆã¿è¨­å®š / Saved Configurations</h3>
            
            <div id="saved-configs">
                <p>ä¿å­˜æ¸ˆã¿è¨­å®šã‚’èª­ã¿è¾¼ã¿ä¸­...</p>
            </div>
            
            <div class="button-group">
                <button class="btn btn-primary" onclick="loadSavedConfigs()">
                    ğŸ”„ è¨­å®šå†èª­ã¿è¾¼ã¿ / Reload Configurations
                </button>
                <button class="btn btn-warning" onclick="exportConfigs()">
                    ğŸ“¤ è¨­å®šã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ / Export Configurations
                </button>
                <button class="btn btn-success" onclick="importConfigs()">
                    ğŸ“¥ è¨­å®šã‚¤ãƒ³ãƒãƒ¼ãƒˆ / Import Configurations
                </button>
            </div>
        </div>
    </div>

    <script>
        let testResults = document.getElementById('test-results');
        
        function log(message, className = '') {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `[${timestamp}] ${message}\n`;
            testResults.innerHTML += `<span class="${className}">${logEntry}</span>`;
            testResults.scrollTop = testResults.scrollHeight;
        }
        
        // ãƒ—ãƒªã‚»ãƒƒãƒˆè¨­å®š
        function setPreset(inputId, xpathValue) {
            document.getElementById(inputId).value = xpathValue;
            log(`ğŸ“‹ ãƒ—ãƒªã‚»ãƒƒãƒˆè¨­å®šé©ç”¨: ${inputId} = ${xpathValue}`, 'info');
        }
        
        // XPathãƒ†ã‚¹ãƒˆ
        async function testXPath() {
            testResults.innerHTML = '';
            log('ğŸ§ª XPathãƒ†ã‚¹ãƒˆã‚’é–‹å§‹ã—ã¾ã™...', 'info');
            
            const messageInputXPath = document.getElementById('message-input-xpath').value;
            const sendButtonXPath = document.getElementById('send-button-xpath').value;
            const messageDisplayXPath = document.getElementById('message-display-xpath').value;
            
            if (!messageInputXPath && !sendButtonXPath && !messageDisplayXPath) {
                log('âŒ ãƒ†ã‚¹ãƒˆã™ã‚‹XPathãŒå…¥åŠ›ã•ã‚Œã¦ã„ã¾ã›ã‚“', 'error');
                return;
            }
            
            try {
                // ç¾åœ¨ã®ã‚¿ãƒ–ã§XPathãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ
                const tabs = await chrome.tabs.query({ active: true, currentWindow: true });
                if (tabs.length === 0) {
                    log('âŒ ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªã‚¿ãƒ–ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“', 'error');
                    return;
                }
                
                const tabId = tabs[0].id;
                log(`ğŸŒ ãƒ†ã‚¹ãƒˆå¯¾è±¡ã‚¿ãƒ–: ${tabs[0].url}`, 'info');
                
                // ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¹ã‚¯ãƒªãƒ—ãƒˆã«XPathãƒ†ã‚¹ãƒˆã‚’ä¾é ¼
                const response = await chrome.tabs.sendMessage(tabId, {
                    type: 'TEST_XPATH',
                    xpaths: {
                        messageInput: messageInputXPath,
                        sendButton: sendButtonXPath,
                        messageDisplay: messageDisplayXPath
                    }
                });
                
                if (response && response.success) {
                    log('âœ… XPathãƒ†ã‚¹ãƒˆå®Œäº†', 'success');
                    Object.entries(response.results).forEach(([key, result]) => {
                        if (result.found) {
                            log(`âœ… ${key}: è¦ç´ ãŒè¦‹ã¤ã‹ã‚Šã¾ã—ãŸ (${result.count}å€‹)`, 'success');
                        } else {
                            log(`âŒ ${key}: è¦ç´ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ`, 'error');
                        }
                    });
                } else {
                    log('âŒ XPathãƒ†ã‚¹ãƒˆå¤±æ•—', 'error');
                    log(`ã‚¨ãƒ©ãƒ¼: ${response?.error || 'ä¸æ˜ãªã‚¨ãƒ©ãƒ¼'}`, 'error');
                }
                
            } catch (error) {
                log(`âŒ XPathãƒ†ã‚¹ãƒˆä¾‹å¤–: ${error.message}`, 'error');
            }
        }
        
        // XPathæ¤œè¨¼
        function validateXPath() {
            log('\nğŸ” XPathæ§‹æ–‡æ¤œè¨¼ã‚’é–‹å§‹ã—ã¾ã™...', 'info');
            
            const xpaths = {
                'ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å…¥åŠ›': document.getElementById('message-input-xpath').value,
                'é€ä¿¡ãƒœã‚¿ãƒ³': document.getElementById('send-button-xpath').value,
                'ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º': document.getElementById('message-display-xpath').value
            };
            
            let allValid = true;
            
            Object.entries(xpaths).forEach(([name, xpath]) => {
                if (!xpath.trim()) {
                    log(`âš ï¸ ${name}: XPathãŒå…¥åŠ›ã•ã‚Œã¦ã„ã¾ã›ã‚“`, 'warning');
                    return;
                }
                
                try {
                    // XPathæ§‹æ–‡ã®åŸºæœ¬ãƒã‚§ãƒƒã‚¯
                    if (xpath.startsWith('//') || xpath.startsWith('/')) {
                        log(`âœ… ${name}: XPathæ§‹æ–‡ã¯æ­£å¸¸ã§ã™`, 'success');
                    } else {
                        log(`âš ï¸ ${name}: XPathã¯ / ã¾ãŸã¯ // ã§å§‹ã¾ã‚‹ã“ã¨ãŒæ¨å¥¨ã•ã‚Œã¾ã™`, 'warning');
                    }
                    
                    // åŸºæœ¬çš„ãªæ§‹æ–‡ãƒã‚§ãƒƒã‚¯
                    if (xpath.includes('[') && !xpath.includes(']')) {
                        log(`âŒ ${name}: è§’æ‹¬å¼§ãŒé–‰ã˜ã‚‰ã‚Œã¦ã„ã¾ã›ã‚“`, 'error');
                        allValid = false;
                    } else if (xpath.includes('(') && !xpath.includes(')')) {
                        log(`âŒ ${name}: ä¸¸æ‹¬å¼§ãŒé–‰ã˜ã‚‰ã‚Œã¦ã„ã¾ã›ã‚“`, 'error');
                        allValid = false;
                    } else if (xpath.includes('"') && (xpath.split('"').length - 1) % 2 !== 0) {
                        log(`âŒ ${name}: å¼•ç”¨ç¬¦ãŒé–‰ã˜ã‚‰ã‚Œã¦ã„ã¾ã›ã‚“`, 'error');
                        allValid = false;
                    }
                    
                } catch (error) {
                    log(`âŒ ${name}: XPathæ§‹æ–‡ã‚¨ãƒ©ãƒ¼ - ${error.message}`, 'error');
                    allValid = false;
                }
            });
            
            if (allValid) {
                log('ğŸ‰ ã™ã¹ã¦ã®XPathãŒæœ‰åŠ¹ã§ã™ï¼', 'success');
            } else {
                log('âš ï¸ ä¸€éƒ¨ã®XPathã«å•é¡ŒãŒã‚ã‚Šã¾ã™', 'warning');
            }
        }
        
        // è¨­å®šä¿å­˜
        async function saveXPathConfig() {
            log('\nğŸ’¾ XPathè¨­å®šã‚’ä¿å­˜ã—ã¾ã™...', 'info');
            
            const config = {
                name: document.getElementById('config-name').value || 'ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®š',
                targetSite: document.getElementById('target-site-url').value || '*',
                xpaths: {
                    messageInput: document.getElementById('message-input-xpath').value,
                    sendButton: document.getElementById('send-button-xpath').value,
                    messageDisplay: document.getElementById('message-display-xpath').value
                },
                created: new Date().toISOString()
            };
            
            try {
                // Chrome storageã«ä¿å­˜
                const existingConfigs = await chrome.storage.local.get(['xpathConfigs']);
                const configs = existingConfigs.xpathConfigs || [];
                
                // åŒã˜åå‰ã®è¨­å®šãŒã‚ã‚Œã°æ›´æ–°ã€ãªã‘ã‚Œã°è¿½åŠ 
                const existingIndex = configs.findIndex(c => c.name === config.name);
                if (existingIndex >= 0) {
                    configs[existingIndex] = config;
                    log(`ğŸ”„ æ—¢å­˜è¨­å®šã‚’æ›´æ–°: ${config.name}`, 'info');
                } else {
                    configs.push(config);
                    log(`â• æ–°è¦è¨­å®šã‚’è¿½åŠ : ${config.name}`, 'info');
                }
                
                await chrome.storage.local.set({ xpathConfigs: configs });
                log('âœ… è¨­å®šä¿å­˜å®Œäº†', 'success');
                
                // ä¿å­˜æ¸ˆã¿è¨­å®šã‚’å†èª­ã¿è¾¼ã¿
                loadSavedConfigs();
                
            } catch (error) {
                log(`âŒ è¨­å®šä¿å­˜ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        }
        
        // è¨­å®šãƒªã‚»ãƒƒãƒˆ
        function resetXPathConfig() {
            log('\nğŸ”„ XPathè¨­å®šã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã™...', 'info');
            
            document.getElementById('message-input-xpath').value = '';
            document.getElementById('send-button-xpath').value = '';
            document.getElementById('message-display-xpath').value = '';
            document.getElementById('target-site-url').value = '';
            document.getElementById('config-name').value = '';
            
            log('âœ… è¨­å®šãƒªã‚»ãƒƒãƒˆå®Œäº†', 'success');
        }
        
        // ä¿å­˜æ¸ˆã¿è¨­å®šèª­ã¿è¾¼ã¿
        async function loadSavedConfigs() {
            try {
                const result = await chrome.storage.local.get(['xpathConfigs']);
                const configs = result.xpathConfigs || [];
                
                const savedConfigsDiv = document.getElementById('saved-configs');
                
                if (configs.length === 0) {
                    savedConfigsDiv.innerHTML = '<p>ä¿å­˜æ¸ˆã¿è¨­å®šã¯ã‚ã‚Šã¾ã›ã‚“</p>';
                    return;
                }
                
                let html = '';
                configs.forEach((config, index) => {
                    html += `
                        <div class="xpath-item">
                            <div class="xpath-label">ğŸ“‹ ${config.name}</div>
                            <div class="xpath-description">
                                å¯¾è±¡ã‚µã‚¤ãƒˆ: ${config.targetSite}<br>
                                ä½œæˆæ—¥æ™‚: ${new Date(config.created).toLocaleString()}
                            </div>
                            <div class="button-group">
                                <button class="btn btn-primary" onclick="loadConfig(${index})">
                                    ğŸ“¥ èª­ã¿è¾¼ã¿
                                </button>
                                <button class="btn btn-danger" onclick="deleteConfig(${index})">
                                    ğŸ—‘ï¸ å‰Šé™¤
                                </button>
                            </div>
                        </div>
                    `;
                });
                
                savedConfigsDiv.innerHTML = html;
                
            } catch (error) {
                log(`âŒ è¨­å®šèª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        }
        
        // è¨­å®šèª­ã¿è¾¼ã¿
        async function loadConfig(index) {
            try {
                const result = await chrome.storage.local.get(['xpathConfigs']);
                const configs = result.xpathConfigs || [];
                
                if (index >= 0 && index < configs.length) {
                    const config = configs[index];
                    
                    document.getElementById('config-name').value = config.name;
                    document.getElementById('target-site-url').value = config.targetSite;
                    document.getElementById('message-input-xpath').value = config.xpaths.messageInput || '';
                    document.getElementById('send-button-xpath').value = config.xpaths.sendButton || '';
                    document.getElementById('message-display-xpath').value = config.xpaths.messageDisplay || '';
                    
                    log(`ğŸ“¥ è¨­å®šèª­ã¿è¾¼ã¿å®Œäº†: ${config.name}`, 'success');
                }
            } catch (error) {
                log(`âŒ è¨­å®šèª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        }
        
        // è¨­å®šå‰Šé™¤
        async function deleteConfig(index) {
            try {
                const result = await chrome.storage.local.get(['xpathConfigs']);
                const configs = result.xpathConfigs || [];
                
                if (index >= 0 && index < configs.length) {
                    const configName = configs[index].name;
                    configs.splice(index, 1);
                    
                    await chrome.storage.local.set({ xpathConfigs: configs });
                    log(`ğŸ—‘ï¸ è¨­å®šå‰Šé™¤å®Œäº†: ${configName}`, 'info');
                    
                    loadSavedConfigs();
                }
            } catch (error) {
                log(`âŒ è¨­å®šå‰Šé™¤ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        }
        
        // è¨­å®šã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
        async function exportConfigs() {
            try {
                const result = await chrome.storage.local.get(['xpathConfigs']);
                const configs = result.xpathConfigs || [];
                
                const dataStr = JSON.stringify(configs, null, 2);
                const dataBlob = new Blob([dataStr], { type: 'application/json' });
                
                const link = document.createElement('a');
                link.href = URL.createObjectURL(dataBlob);
                link.download = `xpath-configs-${new Date().toISOString().split('T')[0]}.json`;
                link.click();
                
                log('ğŸ“¤ è¨­å®šã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆå®Œäº†', 'success');
                
            } catch (error) {
                log(`âŒ ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        }
        
        // è¨­å®šã‚¤ãƒ³ãƒãƒ¼ãƒˆ
        function importConfigs() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            
            input.onchange = async (event) => {
                try {
                    const file = event.target.files[0];
                    if (!file) return;
                    
                    const text = await file.text();
                    const importedConfigs = JSON.parse(text);
                    
                    await chrome.storage.local.set({ xpathConfigs: importedConfigs });
                    log('ğŸ“¥ è¨­å®šã‚¤ãƒ³ãƒãƒ¼ãƒˆå®Œäº†', 'success');
                    
                    loadSavedConfigs();
                    
                } catch (error) {
                    log(`âŒ ã‚¤ãƒ³ãƒãƒ¼ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
                }
            };
            
            input.click();
        }
        
        // åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', () => {
            if (!chrome.runtime) {
                log('âŒ Chromeæ‹¡å¼µæ©Ÿèƒ½ãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã›ã‚“', 'error');
            } else {
                log('âœ… XPathè¨­å®šç®¡ç†ãƒšãƒ¼ã‚¸ãŒèª­ã¿è¾¼ã¾ã‚Œã¾ã—ãŸ', 'success');
                loadSavedConfigs();
            }
        });
    </script>
</body>
</html>
